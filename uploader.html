
<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>رفع أسئلة — quiz2</title>
  <style>
    body{font-family:Tajawal,system-ui,Arial;margin:0;background:#0b1220;color:#e5e7eb}
    .wrap{max-width:900px;margin:auto;padding:16px}
    .card{background:#0f172a;border:1px solid #233048;border-radius:14px;padding:16px}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .btn{background:#0b1220;border:1px solid #223049;color:#e5e7eb;padding:10px 12px;border-radius:10px;cursor:pointer}
    .btn.primary{background:linear-gradient(135deg,#22c55e,#06b6d4);border:none;font-weight:700}
    .log{background:#0a0f1a;border:1px solid #223049;border-radius:10px;padding:10px;max-height:260px;overflow:auto;white-space:pre-wrap}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:8px}
    .item{border:1px solid #223049;border-radius:10px;padding:8px}
    img{max-width:100%;height:120px;object-fit:contain;background:#09121b;border-radius:8px}
  </style>
</head>
<body>
<div class='wrap'>
  <h1>رفع صور الأسئلة إلى Storage + حفظ القائمة في RTDB (quiz2)</h1>
  <div class='card'>
    <div class='row'>
      <input id='files' type='file' accept='image/*' multiple class='btn'/>
      <button id='uploadBtn' class='btn primary'>بدء الرفع</button>
      <button id='saveJson' class='btn'>تنزيل questions.json</button>
      <span id='status'></span>
    </div>
    <div id='preview' class='grid' style='margin-top:12px'></div>
  </div>
  <h3>السجل</h3>
  <div id='log' class='log'></div>
</div>
<script type='module'>
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js';
import { getAuth, signInAnonymously } from 'https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js';
import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.12.5/firebase-storage.js';
import { getDatabase, ref as dRef, set } from 'https://www.gstatic.com/firebasejs/10.12.5/firebase-database.js';
import { firebaseConfig } from './firebase-config.js';
const app=initializeApp(firebaseConfig); const auth=getAuth(app); const storage=getStorage(app); const db=getDatabase(app);
const filesEl=document.getElementById('files'); const uploadBtn=document.getElementById('uploadBtn'); const statusEl=document.getElementById('status'); const logEl=document.getElementById('log'); const previewEl=document.getElementById('preview'); const saveJsonBtn=document.getElementById('saveJson');
function log(m){ logEl.textContent += "
"+m; logEl.scrollTop = logEl.scrollHeight; }
let uploaded=[];
filesEl.addEventListener('change',()=>{ previewEl.innerHTML=''; for(const f of filesEl.files){ const d=document.createElement('div'); d.className='item'; const img=document.createElement('img'); img.src=URL.createObjectURL(f); const p=document.createElement('div'); p.textContent=f.name; d.appendChild(img); d.appendChild(p); previewEl.appendChild(d);} });
saveJsonBtn.addEventListener('click',()=>{ const questions = uploaded.map((u,i)=>({id:i+1,image:u.url,choices:["أ","ب","ج","د"],correct:null})); const blob=new Blob([JSON.stringify({questions},null,2)],{type:'application/json'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='questions.json'; a.click(); URL.revokeObjectURL(a.href); });
uploadBtn.addEventListener('click', async()=>{ try{ statusEl.textContent='تسجيل دخول...'; await signInAnonymously(auth); statusEl.textContent='جاري الرفع...'; uploaded=[]; let i=0; for(const f of filesEl.files){ const path=`quiz2/${Date.now()}_${i++}_${f.name.replace(/\s+/g,'_')}`; const ref=sRef(storage,path); await uploadBytes(ref,f); const url=await getDownloadURL(ref); uploaded.push({path,url,name:f.name}); log(`✔️ ${f.name} → ${path}`);} const q=uploaded.map((u,idx)=>({id:idx+1,image:u.url,choices:["أ","ب","ج","د"],correct:null})); await set(dRef(db,'quizzes/quiz2/questions'), q); statusEl.textContent=`تم الرفع: ${uploaded.length} ملف.`; log('تم حفظ questions تحت quizzes/quiz2/questions'); }catch(e){ console.error(e); log('❌ خطأ: '+e.message); statusEl.textContent='فشل الرفع'; } });
</script>
</body>
</html>
